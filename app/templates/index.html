{% extends "base.html" %}

{% block content %}
<div class="container is-max-widescreen">
    <div class="columns is-vcentered is-centered">
        <div class="column is-8-tablet is-6-desktop has-text-centered">

            <div class="mb-6 fade-in-up">
                <h1 class="title is-1 is-size-2-mobile"
                    style="background: -webkit-linear-gradient(45deg, #1e293b, #4b5563); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; letter-spacing: -1px;">
                    Your Images, <br>
                    <span
                        style="background: -webkit-linear-gradient(45deg, var(--primary), var(--secondary)); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Understood
                        & Purified.</span>
                </h1>
                <p class="subtitle is-5 has-text-grey mt-3">
                    Drag and drop your photos to reveal hidden metadata, edit details, or scrub them clean for privacy.
                </p>
            </div>

            <div class="card p-2 fade-in-up delay-100">
                <form action="/" method="post" enctype="multipart/form-data">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <div class="upload-area">
                        <span class="icon is-large">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </span>
                        <h3 class="title is-4 mb-2">Drop your image(s) here</h3>
                        <p class="is-size-6 has-text-grey mb-4 mt-2">or click to browse</p>

                        <input type="file" name="image" accept=".jpg,.jpeg,.png,.webp,.tiff" id="file-upload" multiple>

                    </div>

                    <div id="file-list" class="mt-3" style="display: none;">
                        <p class="heading has-text-grey-light is-size-7 mb-1">Selected Files:</p>
                        <div id="file-items" class="is-size-6 has-text-grey-dark"
                            style="max-height: 100px; overflow-y: auto;"></div>
                    </div>

                    <p class="help is-danger is-hidden" id="upload-error">Max 10 files allowed.</p>

                    <script>
                        const input = document.getElementById('file-upload');
                        const fileListDiv = document.getElementById('file-list');
                        const fileItemsDiv = document.getElementById('file-items');
                        const errorDisplay = document.getElementById('upload-error');
                        const uploadArea = document.querySelector('.upload-area');
                        const maxFiles = 10;

                        function updateFileList(files) {
                            console.log('Files selected:', files.length);
                            errorDisplay.classList.add('is-hidden');
                            fileItemsDiv.innerHTML = '';

                            if (files.length > maxFiles) {
                                errorDisplay.textContent = `Too many files! Max limit is ${maxFiles}.`;
                                errorDisplay.classList.remove('is-hidden');
                                input.value = '';
                                fileListDiv.style.display = 'none';
                                return;
                            }

                            if (files.length > 0) {
                                fileListDiv.style.display = 'block';
                                Array.from(files).forEach(file => {
                                    console.log('Adding file:', file.name);
                                    const p = document.createElement('p');
                                    p.className = 'is-flex is-align-items-center';
                                    p.innerHTML = `<span class="icon is-small has-text-info mr-2"><i class="fas fa-image"></i></span> <span>${file.name}</span>`;
                                    p.style.marginBottom = '0.25rem';
                                    p.style.fontSize = '0.9rem';
                                    p.style.whiteSpace = 'nowrap';
                                    p.style.overflow = 'hidden';
                                    p.style.textOverflow = 'ellipsis';
                                    fileItemsDiv.appendChild(p);
                                });
                            } else {
                                fileListDiv.style.display = 'none';
                            }
                        }

                        input.addEventListener('change', (e) => {
                            console.log('Input change event');
                            updateFileList(input.files);
                        });

                        // Drag & Drop specific handlers
                        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                            uploadArea.addEventListener(eventName, preventDefaults, false);
                        });

                        function preventDefaults(e) {
                            e.preventDefault();
                            e.stopPropagation();
                        }

                        ['dragenter', 'dragover'].forEach(eventName => {
                            uploadArea.addEventListener(eventName, highlight, false);
                        });

                        ['dragleave', 'drop'].forEach(eventName => {
                            uploadArea.addEventListener(eventName, unhighlight, false);
                        });

                        function highlight(e) {
                            uploadArea.classList.add('is-active');
                            uploadArea.style.borderColor = 'var(--primary)';
                            uploadArea.style.backgroundColor = '#f0f9ff';
                        }

                        function unhighlight(e) {
                            uploadArea.classList.remove('is-active');
                            uploadArea.style.borderColor = '#dbdbdb';
                            uploadArea.style.backgroundColor = 'rgba(255, 255, 255, 0.5)';
                        }

                        uploadArea.addEventListener('drop', handleDrop, false);

                        function handleDrop(e) {
                            console.log('Drop event');
                            const dt = e.dataTransfer;
                            const files = dt.files;

                            if (files.length > 0) {
                                input.files = files; // Modern browsers allow this
                                updateFileList(files);
                            }
                        }
                    </script>

                    <div class="p-4">
                        <button type="submit" class="button is-primary is-medium is-fullwidth shadow-md">
                            <span class="icon"><i class="fas fa-magic"></i></span>
                            <span>Analyze Image</span>
                        </button>
                    </div>
                </form>
            </div>

            <p class="help mt-4 fade-in-up delay-200">
                <span class="icon-text has-text-grey-light">
                    <span class="icon"><i class="fas fa-shield-alt"></i></span>
                    <span>100% Private. Files are deleted automatically.</span>
                </span>
            </p>

        </div>
    </div>
</div>
{% endblock %}